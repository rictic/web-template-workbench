{"version":3,"file":"live_test.js","sourceRoot":"","sources":["../../../src/test/directives/live_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport {live} from '../../directives/live.js';\nimport {html, noChange, nothing, render} from '../../index.js';\nimport {assert} from '@esm-bundle/chai';\n\nclass LiveTester extends HTMLElement {\n  _x?: string;\n  _setCount = 0;\n\n  get x(): string | undefined {\n    return this._x;\n  }\n\n  set x(v: string | undefined) {\n    this._x = v;\n    this._setCount++;\n  }\n}\ncustomElements.define('live-tester', LiveTester);\n\nsuite('live directive', () => {\n  let container: HTMLDivElement;\n\n  setup(() => {\n    container = document.createElement('div');\n  });\n\n  suite('properties', () => {\n    test('live() is useful: property bindings ignore external changes', () => {\n      const go = (x: string) =>\n        render(html`<input .value=\"${x}\" />}`, container);\n      go('a');\n      const el = container.firstElementChild as HTMLInputElement;\n      el.value = 'b';\n      go('a');\n      assert.equal(el.value, 'b');\n    });\n\n    test('updates an externally set property', () => {\n      const go = (x: string) =>\n        render(html`<input .value=\"${live(x)}\" />}`, container);\n      go('a');\n      const el = container.firstElementChild as HTMLInputElement;\n      el.value = 'b';\n      go('a');\n      assert.equal(el.value, 'a');\n    });\n\n    test('does not set a non-changed property', () => {\n      const go = (x: string) =>\n        render(html`<live-tester .x=\"${live(x)}\"></live-tester>`, container);\n      go('a');\n      const el = container.querySelector('live-tester') as LiveTester;\n      assert.equal(el.x, 'a');\n      assert.equal(el._setCount, 1);\n      go('a');\n      assert.equal(el.x, 'a');\n      assert.equal(el._setCount, 1);\n    });\n\n    test('noChange works', () => {\n      const go = (x: unknown) =>\n        render(html`<input .value=\"${live(x)}\" />}`, container);\n      go('a');\n      const el = container.firstElementChild as HTMLInputElement;\n      el.value = 'b';\n      go(noChange);\n      assert.equal(el.value, 'b');\n    });\n  });\n\n  suite('attributes', () => {\n    test('updates an externally set attribute', () => {\n      const go = (x: string) =>\n        render(html`<div class=\"${live(x)}\">}</div>`, container);\n      go('a');\n      const el = container.firstElementChild as HTMLDivElement;\n      el.className = 'b';\n      go('a');\n      assert.equal(el.getAttribute('class'), 'a');\n    });\n\n    test('does not set a non-changed attribute', async () => {\n      let mutationCount = 0;\n      const observer = new MutationObserver((records) => {\n        mutationCount += records.length;\n      });\n      const go = (x: string) =>\n        render(\n          html`<div x=\"${live(x)}\"></div>\n            }`,\n          container\n        );\n      go('a');\n      const el = container.firstElementChild as LiveTester;\n      assert.equal(el.getAttribute('x'), 'a');\n\n      observer.observe(el, {attributes: true});\n\n      go('b');\n      await new Promise((resolve) => setTimeout(resolve, 0));\n      assert.equal(el.getAttribute('x'), 'b');\n      assert.equal(mutationCount, 1);\n\n      go('b');\n      await new Promise((resolve) => setTimeout(resolve, 0));\n      assert.equal(el.getAttribute('x'), 'b');\n      assert.equal(mutationCount, 1);\n    });\n  });\n\n  test('removes an attribute with nothing', () => {\n    const go = (x: any) =>\n      render(html`<div class=\"${live(x)}\">}</div>`, container);\n    go('a');\n    const el = container.firstElementChild as HTMLDivElement;\n    el.className = 'b';\n    go(nothing);\n    assert.isFalse(el.hasAttribute('class'));\n  });\n\n  test('noChange works', () => {\n    const go = (x: any) =>\n      render(html`<div class=\"${live(x)}\">}</div>`, container);\n    go('a');\n    const el = container.firstElementChild as HTMLDivElement;\n    el.className = 'b';\n    go(noChange);\n    assert.equal(el.getAttribute('class'), 'b');\n  });\n\n  test('does not set a non-changed attribute with a non-string value', async () => {\n    let mutationCount = 0;\n    const observer = new MutationObserver((records) => {\n      mutationCount += records.length;\n    });\n    const go = (x: number) =>\n      render(\n        html`<div x=\"${live(x)}\"></div>\n          }`,\n        container\n      );\n    go(1);\n    const el = container.firstElementChild as LiveTester;\n    assert.equal(el.getAttribute('x'), '1');\n\n    observer.observe(el, {attributes: true});\n\n    go(2);\n    await new Promise((resolve) => setTimeout(resolve, 0));\n    assert.equal(el.getAttribute('x'), '2');\n    assert.equal(mutationCount, 1);\n\n    go(2);\n    await new Promise((resolve) => setTimeout(resolve, 0));\n    assert.equal(el.getAttribute('x'), '2');\n    assert.equal(mutationCount, 1);\n  });\n\n  suite('boolean attributes', () => {\n    test('updates an externally set boolean attribute', () => {\n      const go = (x: boolean) =>\n        render(\n          html`<div ?hidden=\"${live(x)}\"></div>\n            }`,\n          container\n        );\n\n      go(true);\n      const el = container.firstElementChild as HTMLDivElement;\n      assert.equal(el.getAttribute('hidden'), '');\n\n      go(true);\n      assert.equal(el.getAttribute('hidden'), '');\n\n      el.removeAttribute('hidden');\n      assert.equal(el.getAttribute('hidden'), null);\n\n      go(true);\n      assert.equal(el.getAttribute('hidden'), '');\n    });\n\n    test('does not set a non-changed boolean attribute', async () => {\n      let mutationCount = 0;\n      const observer = new MutationObserver((records) => {\n        mutationCount += records.length;\n      });\n      const go = (x: boolean) =>\n        render(\n          html`<div ?hidden=\"${live(x)}\"></div>\n            }`,\n          container\n        );\n\n      go(true);\n      const el = container.firstElementChild as LiveTester;\n      assert.equal(el.getAttribute('hidden'), '');\n\n      observer.observe(el, {attributes: true});\n\n      go(false);\n      await new Promise((resolve) => setTimeout(resolve, 0));\n      assert.equal(el.getAttribute('hidden'), null);\n      assert.equal(mutationCount, 1);\n\n      go(false);\n      await new Promise((resolve) => setTimeout(resolve, 0));\n      assert.equal(el.getAttribute('hidden'), null);\n      assert.equal(mutationCount, 1);\n    });\n  });\n});\n"]}